@namespace ManaApp.Components.Products

<div class="products-toolbar">

    <div class="root-filter">

        <button type="button"
                class="root-pill @(string.IsNullOrWhiteSpace(SelectedRoot) ? "active" : null)"
                @onclick="@(() => OnRootChanged.InvokeAsync(""))">
            Visi
        </button>

        <button type="button"
                class="root-pill @(SelectedRoot == "KAUSS" ? "active" : null)"
                @onclick="@(() => OnRootChanged.InvokeAsync("KAUSS"))">
            Kausi
        </button>

        <button type="button"
                class="root-pill @(SelectedRoot == "ADAPTERIS" ? "active" : null)"
                @onclick="@(() => OnRootChanged.InvokeAsync("ADAPTERIS"))">
            Adapteri
        </button>

    </div>

    <select class="filter-select" @onchange="OnCategoryChanged">
        <option value="">-- Visi --</option>
        @foreach (var parent in Categories)
        {
            <option value="@parent">@parent</option>
        }
    </select>

    <div class="products-search-wrap">
                <input type="text"
                        class="products-search"
                        placeholder="Meklēt..."
                        value="@SearchText"
                        @oninput="HandleSearchInput" />

                <button type="button"
                        class="products-clear"
                        @onclick="HandleClear"
                        disabled="@(!HasFilters)">
                    ✕
                </button>
    </div>

    <div class="filters-actions">

        <button type="button"
                class="action-btn"
                @onclick="OnNew">
            Jauns
        </button>

        <button type="button"
                class="action-btn"
                @onclick="OnEdit"
                disabled="@(!CanEdit)">
            Labot
        </button>

        <button type="button"
                class="action-btn"
                @onclick="OnDelete"
                disabled="@(!CanDelete)">
            Dzēst
        </button>

    </div>

</div>
@code {
    [Parameter] public string SelectedRoot { get; set; } = "";
    [Parameter] public EventCallback<string> OnRootChanged { get; set; }

    [Parameter] public EventCallback OnNew { get; set; }
    [Parameter] public EventCallback OnEdit { get; set; }
    [Parameter] public EventCallback OnDelete { get; set; }

    [Parameter] public bool CanEdit { get; set; }
    [Parameter] public bool CanDelete { get; set; }
    [Parameter] public IEnumerable<string> Categories { get; set; } = Enumerable.Empty<string>();
    [Parameter] public bool HasFilters { get; set; }

    [Parameter] public EventCallback<ChangeEventArgs> OnCategoryChanged { get; set; }
    [Parameter] public EventCallback<ChangeEventArgs> OnSearch { get; set; }
    [Parameter] public EventCallback OnClear { get; set; }
    [Parameter] public string SearchText { get; set; } = "";
    [Parameter] public EventCallback<string> SearchTextChanged { get; set; }
    
private async Task HandleClear()
{
    await SearchTextChanged.InvokeAsync("");
    await OnSearch.InvokeAsync(new ChangeEventArgs { Value = "" });
    await OnClear.InvokeAsync();
}

private async Task HandleSearchInput(ChangeEventArgs e)
{
    var value = e.Value?.ToString() ?? "";
    await SearchTextChanged.InvokeAsync(value);
    await OnSearch.InvokeAsync(e);
}

}